<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>â˜ï¸ æˆ‘çš„äº‘ç›˜</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 40px;
      max-width: 900px;
      margin: 0 auto;
      background-color: #f9f9fb;
      color: #333;
    }
    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 10px;
    }
    p.subtitle {
      text-align: center;
      color: #7f8c8d;
      font-size: 16px;
      margin-top: 10px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      padding: 12px 16px;
      border-bottom: 1px solid #eee;
      background: white;
      border-radius: 8px;
      margin: 8px 0;
      display: flex;
      align-items: center;
    }
    li:hover {
      background: #f1f5f9;
    }
    a {
      text-decoration: none;
      color: #3498db;
      font-size: 16px;
      flex: 1;
      display: flex;
      align-items: center;
    }
    a:hover {
      text-decoration: underline;
    }
    .icon {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    .size {
      color: #7f8c8d;
      font-size: 14px;
      margin-left: 8px;
    }
    .folder-name {
      font-weight: bold;
      color: #e67e22;
      margin: 20px 0 10px;
      padding-left: 10px;
      border-left: 3px solid #e67e22;
    }
    .footer {
      text-align: center;
      margin-top: 40px;
      color: #95a5a6;
      font-size: 14px;
    }
    .loading {
      text-align: center;
      color: #95a5a6;
      font-style: italic;
    }
    /* é¢„è§ˆå¼¹çª— */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      display: none;
    }
    .modal iframe {
      width: 90%;
      height: 80%;
      border: none;
      background: white;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      color: white;
      font-size: 24px;
      cursor: pointer;
      background: none;
      border: none;
    }
  </style>
</head>
<body>
  <h1>â˜ï¸ æˆ‘çš„äº‘ç›˜</h1>
  <p class="subtitle">ç‚¹å‡»æ–‡ä»¶å³å¯é¢„è§ˆæˆ–ä¸‹è½½</p>
  <ul id="file-list">
    <li class="loading">åŠ è½½ä¸­...</li>
  </ul>
  <p class="footer">æ›´æ–°æ—¶é—´: <span id="update-time"></span></p>

  <!-- é¢„è§ˆå¼¹çª— -->
  <div id="preview-modal" class="modal">
    <button class="close-btn">Ã—</button>
    <iframe id="preview-frame"></iframe>
  </div>

  <script>
    // ğŸ‘‡ ä¿®æ”¹è¿™é‡Œï¼šä½ çš„ GitHub ç”¨æˆ·å å’Œ ä»“åº“å
    const username = 'nolan180940';
    const repo = 'my-cloud';
    const exclude = ['index.html', 'README.md', '.github']; // å¿½ç•¥çš„æ–‡ä»¶

    const fileList = document.getElementById('file-list');
    fileList.innerHTML = '';

    // æ–‡ä»¶ç±»å‹å›¾æ ‡
    function getIcon(name) {
      const ext = name.split('.').pop().toLowerCase();
      if (['pdf'].includes(ext)) return 'ğŸ“•';
      if (['doc', 'docx'].includes(ext)) return 'ğŸ“˜';
      if (['ppt', 'pptx'].includes(ext)) return 'ğŸ“Š';
      if (['xls', 'xlsx'].includes(ext)) return 'ğŸ“ˆ';
      if (['zip', 'rar', '7z'].includes(ext)) return 'ğŸ“¦';
      if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return 'ğŸ–¼ï¸';
      if (['mp4', 'avi'].includes(ext)) return 'ğŸ¬';
      return 'ğŸ“„';
    }

    // ç”Ÿæˆé¢„è§ˆé“¾æ¥
    function getPreviewUrl(filePath) {
      const ext = filePath.split('.').pop().toLowerCase();
      const rawUrl = `https://raw.githubusercontent.com/${username}/${repo}/main/${filePath}`;

      // PDFï¼šæœ¬åœ°é¢„è§ˆ
      if (ext === 'pdf') {
        return filePath;
      }
      // PPTX/PPT/DOCX/XLSXï¼šç”¨å¾®è½¯ Office Online é¢„è§ˆ
      else if (['ppt', 'pptx', 'doc', 'docx', 'xls', 'xlsx'].includes(ext)) {
        return `https://view.officeapps.live.com/op/view.aspx?src=${encodeURIComponent(rawUrl)}`;
      }
      // å›¾ç‰‡ï¼šæœ¬åœ°é¢„è§ˆ
      else if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
        return filePath;
      }
      // å…¶ä»–æ–‡ä»¶ï¼šç›´æ¥ä¸‹è½½
      else {
        return rawUrl;
      }
    }

    // åŠ è½½æ–‡ä»¶å¤¹
    async function loadFolder(path, displayName) {
      const folderLi = document.createElement('li');
      folderLi.className = 'folder-name';
      folderLi.textContent = displayName || path;
      fileList.appendChild(folderLi);

      try {
        const res = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${path}`);
        const files = await res.json();
        files
          .filter(file => file.type === 'file' && !exclude.includes(file.name))
          .forEach(file => {
            const li = document.createElement('li');
            const previewUrl = getPreviewUrl(file.path);
            const ext = file.name.split('.').pop().toLowerCase();

            let previewText = '';
            if (['pdf', 'pptx', 'ppt', 'docx', 'xlsx'].includes(ext)) {
              previewText = 'ã€é¢„è§ˆã€‘';
            } else if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
              previewText = 'ã€æŸ¥çœ‹ã€‘';
            } else {
              previewText = 'ã€ä¸‹è½½ã€‘';
            }

            li.innerHTML = `
              <a href="#" onclick="openPreview('${previewUrl}', '${file.name}'); return false;">
                <span class="icon">${getIcon(file.name)}</span>
                ${file.name}
                <span class="size">(${(file.size / 1024).toFixed(1)} KB)</span>
                <span style="color: #2ecc71;">${previewText}</span>
              </a>
            `;
            fileList.appendChild(li);
          });
      } catch (err) {
        const li = document.createElement('li');
        li.innerHTML = `<a href="#" style="color:red">âŒ åŠ è½½å¤±è´¥: ${path}</a>`;
        fileList.appendChild(li);
        console.error('åŠ è½½æ–‡ä»¶å¤¹å¤±è´¥:', err);
      }
    }

    // åŠ è½½æ ¹ç›®å½•
    async function loadRoot() {
      try {
        const res = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/`);
        const items = await res.json();

        const files = items.filter(item => item.type === 'file' && !exclude.includes(item.name));
        const folders = items.filter(item => item.type === 'dir' && !exclude.includes(item.name));

        // æ ¹æ–‡ä»¶
        files.forEach(file => {
          const li = document.createElement('li');
          const previewUrl = getPreviewUrl(file.name);
          const ext = file.name.split('.').pop().toLowerCase();

          let previewText = '';
          if (['pdf', 'pptx', 'ppt', 'docx', 'xlsx'].includes(ext)) {
            previewText = 'ã€é¢„è§ˆã€‘';
          } else if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
            previewText = 'ã€æŸ¥çœ‹ã€‘';
          } else {
            previewText = 'ã€ä¸‹è½½ã€‘';
          }

          li.innerHTML = `
            <a href="#" onclick="openPreview('${previewUrl}', '${file.name}'); return false;">
              <span class="icon">${getIcon(file.name)}</span>
              ${file.name}
              <span class="size">(${(file.size / 1024).toFixed(1)} KB)</span>
              <span style="color: #2ecc71;">${previewText}</span>
            </a>
          `;
          fileList.appendChild(li);
        });

        // æ–‡ä»¶å¤¹
        for (const folder of folders) {
          await loadFolder(folder.name, `ğŸ“ ${folder.name}`);
        }

      } catch (err) {
        fileList.innerHTML = `<li><a href="#" style="color:red">âŒ åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œä»“åº“å</a></li>`;
        console.error('åŠ è½½ä»“åº“å¤±è´¥:', err);
      }
    }

    // æ‰“å¼€é¢„è§ˆ
    function openPreview(url, filename) {
      const modal = document.getElementById('preview-modal');
      const iframe = document.getElementById('preview-frame');
      const closeBtn = document.querySelector('.close-btn');

      iframe.src = url;
      modal.style.display = 'flex';

      closeBtn.onclick = () => {
        iframe.src = ''; // æ¸…ç©ºï¼Œé¿å…åå°åŠ è½½
        modal.style.display = 'none';
      };

      modal.onclick = (e) => {
        if (e.target === modal) closeBtn.click();
      };
    }

    // å¯åŠ¨
    window.onload = () => {
      loadRoot();
      document.getElementById('update-time').textContent = new Date().toLocaleString();
    };
  </script>
</body>
</html>
